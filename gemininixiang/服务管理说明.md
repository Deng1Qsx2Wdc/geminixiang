# Gemini API 服务管理说明

## 📋 脚本说明

### 1. `install_service.bat` - 安装开机自启动服务
- **功能**: 将服务配置为开机自动启动
- **权限**: 需要管理员权限
- **使用方法**: 右键点击 → 以管理员身份运行

### 2. `start_service.bat` - 启动服务
- **功能**: 启动 Gemini API 服务（后台运行）
- **权限**: 普通用户权限即可
- **使用方法**: 双击运行

### 3. `stop_service.bat` - 停止服务
- **功能**: 停止正在运行的 Gemini API 服务
- **权限**: 普通用户权限即可
- **使用方法**: 双击运行

### 4. `uninstall_service.bat` - 卸载服务
- **功能**: 移除开机自启动配置
- **权限**: 需要管理员权限
- **使用方法**: 右键点击 → 以管理员身份运行

## 🚀 快速开始

### 首次安装（设置开机自启动）

1. **安装服务**（需要管理员权限）
   ```
   右键点击 install_service.bat → 以管理员身份运行
   ```

2. **验证安装**
   - 打开任务计划程序（Win + R，输入 `taskschd.msc`）
   - 查找任务 `GeminiAPIService`
   - 确认任务已创建

3. **立即启动服务**（可选）
   ```
   双击运行 start_service.bat
   ```

### 日常使用

#### 启动服务
```
双击运行 start_service.bat
```

#### 停止服务
```
双击运行 stop_service.bat
```

#### 卸载服务（移除开机自启动）
```
右键点击 uninstall_service.bat → 以管理员身份运行
```

## 📝 详细说明

### 安装服务流程

1. **检查环境**
   - 验证 Python 是否安装
   - 检查 server.py 是否存在

2. **创建任务计划**
   - 任务名称: `GeminiAPIService`
   - 触发条件: 用户登录时
   - 运行方式: 后台运行

3. **生成启动脚本**
   - 自动生成 `start_service_hidden.bat`
   - 用于任务计划程序调用

### 服务管理命令

安装后，也可以使用 Windows 任务计划程序命令管理：

```batch
REM 查看任务状态
schtasks /query /TN "GeminiAPIService"

REM 立即运行任务
schtasks /run /TN "GeminiAPIService"

REM 停止任务（通过停止进程）
stop_service.bat

REM 删除任务
schtasks /delete /TN "GeminiAPIService" /F
```

### 服务状态检查

#### 检查服务是否运行
```batch
netstat -an | findstr ":8000"
```

如果看到 `LISTENING` 状态，说明服务正在运行。

#### 检查进程
```batch
tasklist | findstr python
```

#### 访问服务
- 后台管理: http://localhost:8000/admin
- API 地址: http://localhost:8000/v1

## ⚠️ 注意事项

1. **端口占用**
   - 默认端口: 8000
   - 如果端口被占用，服务将无法启动
   - 可以使用 `netstat -ano | findstr ":8000"` 查看端口占用情况

2. **防火墙设置**
   - 如果需要在局域网访问，需要开放 8000 端口
   - 可以在 Windows 防火墙中添加规则

3. **Python 环境**
   - 确保 Python 已添加到系统 PATH
   - 建议使用 Python 3.8 或更高版本

4. **依赖包**
   - 首次运行会自动检查并安装依赖
   - 如果安装失败，请手动运行: `pip install -r requirements.txt`

5. **配置文件**
   - 服务启动前需要先配置 Cookie
   - 访问 http://localhost:8000/admin 进行配置

## 🔧 故障排除

### 问题1: 服务无法启动
- 检查 Python 是否安装: `python --version`
- 检查端口是否被占用: `netstat -an | findstr ":8000"`
- 查看错误信息: 运行 `start_service.bat` 查看详细错误

### 问题2: 开机不自启动
- 检查任务计划程序中的任务是否存在
- 检查任务是否启用
- 尝试手动运行任务: `schtasks /run /TN "GeminiAPIService"`

### 问题3: 无法停止服务
- 使用 `stop_service.bat` 停止
- 如果失败，可能需要管理员权限
- 也可以使用任务管理器手动结束 Python 进程

### 问题4: 权限不足
- 安装/卸载服务需要管理员权限
- 右键点击脚本 → 以管理员身份运行

## 📞 技术支持

如果遇到问题，请检查：
1. Python 版本和安装路径
2. 依赖包是否完整安装
3. 端口 8000 是否被占用
4. 防火墙设置是否正确
5. 配置文件 `config_data.json` 是否存在且有效


